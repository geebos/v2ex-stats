## 1. 需求概述

实现 v2ex 年终总结功能，对用户近一年的铜币消耗和获取记录进行聚合分析，生成可视化的年度总结报告。报告涵盖用户在 v2ex 上的各类活动数据，包括发帖、回复、感谢、登录等行为的统计分析，帮助用户全面了解自己在 v2ex 社区一年的活动轨迹。

## 2. 功能点拆分与依赖

| 功能点序号 | 功能点名称 | 功能点描述 | 前置依赖 |
|------------|------------|------------|----------|
| 1 | 数据时间范围筛选 | 支持筛选近一年的铜币记录数据，可配置起止时间范围 | 无 |
| 2 | 回复行为统计 | 统计回复帖子的总次数、消耗的铜币总量、回复时间分布（按月/周/小时） | 1 |
| 3 | 发帖行为统计 | 统计发布帖子的总次数、消耗的铜币总量、发帖时间分布 | 1 |
| 4 | 邀请码与充值统计 | 统计生成邀请码的次数及消耗、充值记录和金额 | 1 |
| 5 | 登录行为统计 | 统计登录次数、登录时间分布、通过登录获取的铜币总量 | 1 |
| 6 | 感谢行为统计 | 统计感谢他人的次数、消耗的铜币总量、感谢时间分布 | 1 |
| 7 | 收到感谢统计 | 统计收到感谢的次数、获得的铜币总量、收到感谢最多的帖子和评论（Top 5） | 1 |
| 8 | 铜币收支总览 | 汇总展示铜币的总收入、总支出、净变化，以及收支占比分析 | 2, 3, 4, 5, 6, 7 |
| 9 | 活动时间热力图 | 按小时和星期维度展示用户活动的时间分布热力图 | 2, 3, 5, 6 |
| 10 | 可视化报告生成 | 将上述统计数据整合成可视化的年终总结报告页面，支持导出和分享 | 8, 9 |

## 3. 详细功能说明

### 3.1 数据时间范围筛选
- 默认统计最近一年（365天）的数据
- 支持自定义起止日期
- 对历史数据进行查询和聚合

### 3.2 回复行为统计
- **统计指标**：
  - 回复总次数
  - 消耗铜币总量
  - 平均每次回复消耗的铜币
- **时间分布**：
  - 按月份统计回复趋势
  - 按星期几统计活跃度
  - 按小时统计回复高峰时段

### 3.3 发帖行为统计
- **统计指标**：
  - 发帖总次数
  - 消耗铜币总量
  - 平均每次发帖消耗的铜币
- **时间分布**：
  - 按月份统计发帖趋势
  - 发帖最活跃的时间段

### 3.4 邀请码与充值统计
- 生成邀请码的次数和消耗铜币
- 充值记录和充值金额统计
- 充值与消耗的对比分析

### 3.5 登录行为统计
- **统计指标**：
  - 登录总次数
  - 通过登录获取的铜币总量
  - 平均每次登录获得的铜币
- **时间分布**：
  - 连续登录天数统计
  - 登录时间分布

### 3.6 感谢行为统计
- **统计指标**：
  - 感谢他人总次数
  - 消耗铜币总量
  - 平均每次感谢消耗的铜币
- **行为分析**：
  - 最常感谢的用户（Top 5）
  - 感谢行为的时间分布

### 3.7 收到感谢统计
- **统计指标**：
  - 收到感谢总次数
  - 获得铜币总量
  - 平均每次获得的铜币
- **内容分析**：
  - 收到感谢最多的帖子（Top 5，包含标题、链接、感谢次数）
  - 收到感谢最多的评论（Top 5，包含内容预览、所在帖子、感谢次数）

### 3.8 铜币收支总览
- **收入分析**：
  - 登录获得的铜币
  - 收到感谢获得的铜币
  - 其他收入来源
  - 各类收入占比
- **支出分析**：
  - 发帖消耗的铜币
  - 回复消耗的铜币
  - 感谢他人消耗的铜币
  - 其他支出
  - 各类支出占比
- **净变化**：年度铜币余额变化趋势

### 3.9 活动时间热力图
- 按星期和小时展示活动热力图（7x24 矩阵）
- 颜色深度表示活动频率
- 标注最活跃的时间段

### 3.10 可视化报告生成
- **报告结构**：
  - 年度数据概览卡片
  - 各类统计图表（柱状图、折线图、饼图、热力图）
  - 高亮展示关键指标和排行榜
- **交互功能**：
  - 支持切换不同时间维度查看
  - 支持导出为图片或 PDF
  - 支持一键分享到社交平台

## 4. 技术实现要点

### 4.1 数据聚合
- 从 storage 中读取铜币历史记录
- 按交易类型进行分类聚合
- 缓存聚合结果以提升性能

### 4.2 图表渲染
- 使用现有的图表组件（如 ActivityChart、BalanceChart）
- 新增热力图组件
- 统一图表样式和交互体验

### 4.3 性能优化
- 大数据量时采用分页或虚拟滚动
- 异步加载各个统计模块
- 缓存已计算的统计结果

### 4.4 用户体验
- 添加加载动画和骨架屏
- 支持暗黑模式
- 响应式布局适配不同屏幕

## 5. 验收标准

- [ ] 能够正确筛选近一年的数据记录
- [ ] 各类行为统计数据准确无误
- [ ] 时间分布图表展示清晰
- [ ] 收到感谢最多的帖子/评论排行正确
- [ ] 铜币收支总览计算准确
- [ ] 活动时间热力图正确反映用户活跃时段
- [ ] 报告页面布局美观，交互流畅
- [ ] 支持导出和分享功能
- [ ] 大数据量场景下性能良好
